"use strict";(self.webpackChunkxpert_ai=self.webpackChunkxpert_ai||[]).push([[5018],{"./packages/core/src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A4e:()=>AbstractDataSource,fef:()=>AbstractEntityService,p$2:()=>AdvancedSlicerOperator,Lpr:()=>types_AgentStatusEnum,Eoi:()=>types_AgentType,YiE:()=>AggregationOperation,jwq:()=>AggregationOperations,H$f:()=>property_AggregationRole,O6i:()=>AnalyticsBusinessService,mpi:()=>types_C_MEASURES,ddH:()=>C_MEASURES_CAPTION,ASJ:()=>calculated_CalculationType,UHH:()=>ChartBusinessService,iwK:()=>ChartDataZoomType,vP4:()=>ChartDimensionRoleType,l2b:()=>ChartMeasureRoleType,AiK:()=>chart_ChartOrient,mYd:()=>CompareToEnum,FMq:()=>DSCacheService,_R7:()=>DSCoreService,yJE:()=>DimensionMemberRecursiveHierarchy,vQU:()=>DimensionType,Y$2:()=>DisplayBehaviour,gMs:()=>Drill,J1Z:()=>EntitySemantics,cDT:()=>FILTER_OPERATOR_DESC,tlN:()=>types_FilterOperator,dDN:()=>FilterSelectionType,t_k:()=>FilteringLogic,_bK:()=>IndicatorType,lB:()=>IntrinsicMemberProperties,cOo:()=>MemberSource,TGZ:()=>OffSetDirection,qqm:()=>OrderDirection,Yvx:()=>ParameterControlEnum,MsG:()=>PieVariant,OoU:()=>PresentationEnum,A5e:()=>ReferenceLineType,HJR:()=>ReferenceLineValueType,zqw:()=>sdl_RuntimeLevelType,a7d:()=>semantics_Semantics,K0o:()=>SmartChartEngine,ALg:()=>SmartFilterBarService,vC5:()=>SmartFilterService,w4h:()=>Syntax,iG7:()=>TimeGranularity,bJ0:()=>TimeRangeType,Shq:()=>TreeSelectionMode,flO:()=>VariableSelectionType,H6Z:()=>_getPropertyCaption,GfN:()=>advancedSlicerAsString,kpz:()=>assign_assign,DiN:()=>assignDeepOmitBlank,XxF:()=>calcRange,mgf:()=>cloneDeep,oE7:()=>compact,fDc:()=>convertDimensionToSlicer,TrE:()=>countBy,JJv:()=>displayByBehaviour,aSb:()=>filterTreeNodes,EeT:()=>findTreeNode,Bqz:()=>flatten,rGr:()=>flattenDeep,zhb:()=>formatRangeCurrentPeriod,CT9:()=>formatting,HHL:()=>getChartCategory,LlF:()=>getChartCategory2,cJi:()=>getChartSeries,SRC:()=>getChartTrellis,TQZ:()=>helper_getDefaultHierarchy,YDt:()=>getDimensionDisplayBehaviour,xb1:()=>getDimensionMemberCaption,ylx:()=>getEntityCalculations,X$e:()=>getEntityCalendarHierarchy,ttJ:()=>getEntityDefaultMeasure,OgT:()=>getEntityDimensionAndHierarchies,Jwe:()=>helper_getEntityDimensions,dro:()=>getEntityHierarchy,iVP:()=>getEntityLevel,x20:()=>helper_getEntityMeasures,Gk6:()=>getEntityParameters,jZc:()=>getEntityProperty,x6v:()=>helper_getEntityProperty2,DfM:()=>helper_getEntityVariables,uTI:()=>getMeasurePropertyUnit,H4G:()=>getMemberFromRow,x2E:()=>getPropertyHierarchy,wSH:()=>getPropertyMeasure,hmx:()=>getPropertyName,JHR:()=>getPropertyUnitName,vXy:()=>hierarchize,nRp:()=>isAdvancedFilter,bmA:()=>isAdvancedSlicer,yqI:()=>isAggregationProperty,cyL:()=>isArray_isArray,S0y:()=>isCalculatedProperty,nc$:()=>isCalculationProperty,rm:()=>isChartMapType,t56:()=>types_isDimension,Ime:()=>isEmpty_isEmpty,W9i:()=>isEntitySet,mdN:()=>isEntityType,n4T:()=>isEqual,Bp3:()=>calculated_isIndicatorMeasureProperty,txU:()=>types_isMeasure,pIX:()=>isMeasureControlProperty,gD_:()=>isNil_isNil,EtT:()=>isNumber,fXE:()=>isParameterProperty,iEe:()=>isPropertyDimension,$cE:()=>isPropertyHierarchy,UIL:()=>isPropertyLevel,__U:()=>isPropertyMeasure,Dtp:()=>isRestrictedMeasureProperty,pt_:()=>isSemanticCalendar,ZSj:()=>isSlicer,KgX:()=>isString_isString,YIK:()=>isTimeRangesSlicer,IXq:()=>isVariableProperty,zNq:()=>isVisible,MxI:()=>isWrapBrackets,Mq8:()=>mapIndicatorToMeasures,_sC:()=>mapTimeGranularitySemantic,lLk:()=>mergeOptions,zed:()=>negate,TLi:()=>nonNullable,cJW:()=>omit_omit,exP:()=>omitBlank,o28:()=>parameterFormatter,mow:()=>parseDimension,UpN:()=>pick_pick,Md5:()=>putFilter,JKt:()=>serializeUniqueName,OAc:()=>slicerAsString,xTU:()=>stringifyProperty,JJz:()=>timeRangesSlicerAsString,hS4:()=>uniqBy,Hg2:()=>unwrapBrackets,uRe:()=>uuid,esA:()=>helper_wrapBrackets,TTA:()=>wrapHierarchyValue});var Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),BehaviorSubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),filter=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),observable_of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js");function assign_assign(source,...params){return Object.assign(source??{},...params.map((item=>item??{})))}function isArray_isArray(value){return Array.isArray(value)}function isNil_isNil(value){return null==value}function nonNullable(value){return null!=value}function isPlainObject(value){if(!function isObjectLike(value){return"object"==typeof value&&null!==value}(value)||"[object Object]"!=function getTag(value){const toString=Object.prototype.toString;return null==value?void 0===value?"[object Undefined]":"[object Null]":toString.call(value)}(value))return!1;if(null===Object.getPrototypeOf(value))return!0;let proto=value;for(;null!==Object.getPrototypeOf(proto);)proto=Object.getPrototypeOf(proto);return Object.getPrototypeOf(value)===proto}function isString_isString(str){return!isNil_isNil(str)&&"string"==typeof str.valueOf()}function isBlank(value){return isNil_isNil(value)||isString_isString(value)&&!value.trim()}function mergeOptions(obj1,...objs){return assign_assign(obj1,...objs.map((item=>omitBlank(item))))}function assignDeepOmitBlank(source,target,dpth=1){if(isPlainObject(target))return dpth>0?Object.entries(target).filter((([key,value])=>!isBlank(value))).reduce(((obj,[key,value])=>(obj[key]=assignDeepOmitBlank(source?.[key],target[key],dpth-1),obj)),{...source??{}}):assign_assign(source,omitBlank(target));if(isArray_isArray(target)&&isArray_isArray(source)){const result=[];for(let index=0;index<Math.max(target.length,source.length);index++)result.push(assignDeepOmitBlank(source?.[index],target[index],dpth-1));return result}return isBlank(target)?source:target}function omitBlank(obj){return Array.isArray(obj)?obj.map((value=>omitBlank(value))):isPlainObject(obj)?Object.entries(obj).filter((([,v])=>!isBlank(v))).reduce(((r,[key,value])=>({...r,[key]:omitBlank(value)})),{}):obj}function isEmpty_isEmpty(obj){return[Object,Array].includes((obj||{}).constructor)&&!Object.entries(obj||{}).length}function flatten(arr){return arr?.reduce(((prev,curr)=>(prev.push(...Array.isArray(curr)?curr:[curr]),prev)),[])}function isEqual(a,b){return equal(a,b)}function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(a.constructor!==b.constructor)return!1;let length,i,keys;if(Array.isArray(a)){if(length=a.length,length!==b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(a instanceof Map&&b instanceof Map){if(a.size!==b.size)return!1;for(const[key,value]of a.entries())if(!b.has(key)||!equal(value,b.get(key)))return!1;return!0}if(a instanceof Set&&b instanceof Set){if(a.size!==b.size)return!1;for(const value of a.values())if(!b.has(value))return!1;return!0}if(ArrayBuffer.isView(a)&&ArrayBuffer.isView(b)){if(length=a.byteLength,length!==b.byteLength)return!1;for(i=length;0!=i--;)if(a[i]!==b[i])return!1;return!0}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();if(keys=Object.keys(a),length=keys.length,length!==Object.keys(b).length)return!1;for(i=length;0!=i--;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return!1;for(i=length;0!=i--;){const key=keys[i];if(("_owner"!==key||!a.$$typeof)&&!equal(a[key],b[key]))return!1}return!0}return a!=a&&b!=b}function negate(callbackFn){return(...params)=>!callbackFn(...params)}function omitBy_omitBy(obj,callbackFun){return function pickBy(object,predicate=v=>v){return Object.assign({},...Object.entries(object).filter((([,v])=>predicate(v))).map((([k,v])=>({[k]:v}))))}(obj,negate(callbackFun))}function omit_omit(obj,...keys){return keys.reduce(((obj,key)=>{const{[key]:omitted,...rest}=obj;return rest}),obj??{})}function pick_pick(object,...keys){return object&&(keys?.reduce(((obj,key)=>(object&&Object.prototype.hasOwnProperty.call(object,key)&&(obj[key]=object[key]),obj)),{})??{})}function uniqBy(arr,fn){return"string"==typeof fn?arr.filter(((element,index)=>arr.findIndex((step=>element[fn]===step[fn]))===index)):arr.filter(((element,index)=>arr.findIndex((step=>fn(element,step)))===index))}function compact(arr){return arr?.filter(Boolean)}function isNumber(value){return"number"==typeof value&&isFinite(value)}function countBy(arr,key){return arr?.reduce(((prev,curr)=>(prev[curr[key]]=prev[curr[key]]??0,prev[curr[key]]++,prev)),{})??{}}function flattenDeep(arr){return Array.isArray(arr)?arr.reduce(((a,b)=>a.concat(flattenDeep(b))),[]):arr?[arr]:[]}function cloneDeep(obj){return JSON.parse(JSON.stringify(obj))}const DEFAULT_DIGIT_INFO="0.2",FORMAT_LOCALE_DATA={en:{lang:"en-US",shortNumberFactor:3,shortNumberUnits:"K,M,B,T,Q"},"zh-Hans":{lang:"zh-Hans",shortNumberFactor:4,shortNumberUnits:"万,亿,万亿"}};function formatNumber(n,locale,digitsInfo){let[,fractionDigits]=(digitsInfo??DEFAULT_DIGIT_INFO).split(".");return fractionDigits=fractionDigits.split("-")[1]??fractionDigits,Number(n.toFixed(Number(fractionDigits))).toLocaleString(locale??"en")}function strToNumber(value){if("string"==typeof value&&!isNaN(Number(value)-parseFloat(value)))return Number(value);if("number"!=typeof value)throw new Error(`${value} is not a number`);return value}var ChartDimensionRoleType,ChartMeasureRoleType,ReferenceLineType,ReferenceLineValueType,ReferenceLineAggregation,ChartPattern,chart_ChartOrient,BarVariant,WaterfallVariant,PieVariant,ScatterVariant,TreeVariant,HeatmapVariant;!function(ChartDimensionRoleType){ChartDimensionRoleType.Time="Time",ChartDimensionRoleType.Category="Category",ChartDimensionRoleType.Category2="Category2",ChartDimensionRoleType.Color="Color",ChartDimensionRoleType.Group="Group",ChartDimensionRoleType.Stacked="Stacked",ChartDimensionRoleType.Trellis="Trellis",ChartDimensionRoleType.Lat="Lat",ChartDimensionRoleType.Long="Long"}(ChartDimensionRoleType||(ChartDimensionRoleType={})),function(ChartMeasureRoleType){ChartMeasureRoleType.Axis1="Axis1",ChartMeasureRoleType.Axis2="Axis2",ChartMeasureRoleType.Axis3="Axis3",ChartMeasureRoleType.Size="Size",ChartMeasureRoleType.Lightness="Lightness",ChartMeasureRoleType.SizeLightness="SizeLightness",ChartMeasureRoleType.Tooltip="Tooltip"}(ChartMeasureRoleType||(ChartMeasureRoleType={})),function(ReferenceLineType){ReferenceLineType.markPoint="markPoint",ReferenceLineType.markLine="markLine"}(ReferenceLineType||(ReferenceLineType={})),function(ReferenceLineValueType){ReferenceLineValueType.fixed="fixed",ReferenceLineValueType.dynamic="dynamic"}(ReferenceLineValueType||(ReferenceLineValueType={})),function(ReferenceLineAggregation){ReferenceLineAggregation.min="min",ReferenceLineAggregation.max="max",ReferenceLineAggregation.average="average",ReferenceLineAggregation.median="median"}(ReferenceLineAggregation||(ReferenceLineAggregation={})),function(ChartPattern){ChartPattern[ChartPattern.a=0]="a",ChartPattern[ChartPattern.b=1]="b",ChartPattern[ChartPattern.c=2]="c",ChartPattern[ChartPattern.d=3]="d",ChartPattern[ChartPattern.e=4]="e",ChartPattern[ChartPattern.f=5]="f",ChartPattern[ChartPattern.g=6]="g",ChartPattern[ChartPattern.h=7]="h"}(ChartPattern||(ChartPattern={})),function(ChartOrient){ChartOrient.horizontal="horizontal",ChartOrient.vertical="vertical"}(chart_ChartOrient||(chart_ChartOrient={})),function(BarVariant){BarVariant.None="none",BarVariant.Polar="polar",BarVariant.Stacked="stacked"}(BarVariant||(BarVariant={})),function(WaterfallVariant){WaterfallVariant.None="none",WaterfallVariant.Polar="polar"}(WaterfallVariant||(WaterfallVariant={})),function(PieVariant){PieVariant.None="none",PieVariant.Doughnut="doughnut",PieVariant.Nightingale="nightingale"}(PieVariant||(PieVariant={})),function(ScatterVariant){ScatterVariant.None="none",ScatterVariant.Polar="polar"}(ScatterVariant||(ScatterVariant={})),function(TreeVariant){TreeVariant.None="none",TreeVariant.Reverse="reverse",TreeVariant.Radial="radial"}(TreeVariant||(TreeVariant={})),function(HeatmapVariant){HeatmapVariant.None="none",HeatmapVariant.Calendar="calendar"}(HeatmapVariant||(HeatmapVariant={}));const isChartMapType=toBe=>"GeoMap"===toBe?.type;function getChartTrellis(chartAnnotation){return chartAnnotation.dimensions.find((item=>item?.role===ChartDimensionRoleType.Trellis))}function getChartCategory(chartAnnotation){return chartAnnotation?.dimensions.find((dimension=>dimension?.role===ChartDimensionRoleType.Category||dimension?.role===ChartDimensionRoleType.Time))||chartAnnotation?.dimensions.find((dimension=>isNil_isNil(dimension?.role)))}function getChartCategory2(chartAnnotation){return chartAnnotation?.dimensions.find((dimension=>dimension?.role===ChartDimensionRoleType.Category2))}function getChartSeries(chartAnnotation){const dimensions=chartAnnotation.dimensions.filter((d=>d.role!==ChartDimensionRoleType.Time));return dimensions.find((item=>item?.role===ChartDimensionRoleType.Color||item?.role===ChartDimensionRoleType.Group||item?.role===ChartDimensionRoleType.Stacked||item?.role===ChartDimensionRoleType.Category2))||["color","group","stacked"].includes(chartAnnotation.chartType.variant)&&(dimensions[1]||dimensions[0])}var CriticalityType,TrendType,VisualizationType,ImprovementDirectionType,PeriodFunctions,semantics_Semantics;function hierarchize(items,recursiveHierarchy,options){const root=[],results={};if(items?.forEach((item=>{const itemKey=item[recursiveHierarchy.valueProperty]+(options?.compositeKeys?.map((key=>item[key])).join("/")??"");results[itemKey]||(results[itemKey]={children:[]}),assign_assign(results[itemKey],options?.memberCaption?{key:itemKey,[options?.memberCaption??"label"]:item[recursiveHierarchy.labelProperty],caption:item[recursiveHierarchy.labelProperty],raw:item}:{key:itemKey,label:item[recursiveHierarchy.labelProperty],title:item[recursiveHierarchy.labelProperty],name:item[recursiveHierarchy.labelProperty],caption:item[recursiveHierarchy.labelProperty],raw:item}),options?.valueProperty&&(results[itemKey].value=item[options.valueProperty]);const parentKey=item[recursiveHierarchy.parentNodeProperty]+(options?.compositeKeys?.map((key=>item[key])).join("/")??"");parentKey?results[parentKey]?results[parentKey].children.push(results[itemKey]):results[parentKey]={children:[results[itemKey]]}:(results[itemKey].level=0,root.push(results[itemKey]))})),Object.values(results).forEach((node=>{isEmpty_isEmpty(node.children)?(node.isLeaf=!0,node.children=null):node.raw||root.push(...node.children)})),options?.onlyLeaves)return Object.values(results).filter((node=>node.isLeaf));if(root.forEach((item=>setLevel(item,0))),options?.startLevel>0){const items=[];return root.map((item=>{items.push(...getTreeLevel(item,options.startLevel))})),items}return root}function setLevel(item,level){item.level=level,item.children&&item.children.forEach((item=>setLevel(item,level+1)))}function getTreeLevel(item,level){if(item.level===level-1)return item.children??[];const items=[];return item.children?.map((item=>{items.push(...getTreeLevel(item,level))})),items}function filterTreeNodes(array,text,options){text=text?.toLowerCase();const getNodes=(result,object)=>{const contains=object.label?.toLowerCase().includes(text)||options?.considerKey&&`${object.key}`?.toLowerCase().includes(text),children=object.children?.reduce(getNodes,[]);return children?.length?result.push({...object,children}):contains&&result.push(omit_omit(object,"children")),result};return text?array.reduce(getNodes,[]):array}function findTreeNode(array,key){const getNodes=(result,object)=>result||(object?.key===key?object:object.children?.reduce(getNodes,null));return array?.reduce(getNodes,null)}!function(CriticalityType){CriticalityType.VeryNegative="VeryNegative",CriticalityType.Neutral="Neutral",CriticalityType.Negative="Negative",CriticalityType.Critical="Critical",CriticalityType.Positive="Positive",CriticalityType.VeryPositive="VeryPositive"}(CriticalityType||(CriticalityType={})),function(TrendType){TrendType.StrongUp="StrongUp",TrendType.Up="Up",TrendType.Sideways="Sideways",TrendType.Down="Down",TrendType.StrongDown="StrongDown"}(TrendType||(TrendType={})),function(VisualizationType){VisualizationType.Number="Number",VisualizationType.BulletChart="BulletChart",VisualizationType.Progress="Progress",VisualizationType.Rating="Rating",VisualizationType.Donut="Donut",VisualizationType.DeltaBulletChart="DeltaBulletChart"}(VisualizationType||(VisualizationType={})),function(ImprovementDirectionType){ImprovementDirectionType.Minimize="Minimize",ImprovementDirectionType.Target="Target",ImprovementDirectionType.Maximize="Maximize"}(ImprovementDirectionType||(ImprovementDirectionType={})),function(PeriodFunctions){PeriodFunctions.CURRENT="CURRENT",PeriodFunctions.YTD="YTD",PeriodFunctions.QTD="QTD",PeriodFunctions.WTD="WTD",PeriodFunctions.MTD="MTD",PeriodFunctions.PYYTD="PYYTD",PeriodFunctions.YOY="YOY",PeriodFunctions.YOYGAP="YOYGAP",PeriodFunctions.MOM="MOM",PeriodFunctions.MOMGAP="MOMGAP",PeriodFunctions.YTDOM="YTDOM",PeriodFunctions.YTDOY="YTDOY",PeriodFunctions.YTDOYGAP="YTDOYGAP",PeriodFunctions.MPM="MPM",PeriodFunctions.MPMYOY="MPMYOY",PeriodFunctions.PYSM="PYSM",PeriodFunctions.PYSMYOY="PYSMYOY"}(PeriodFunctions||(PeriodFunctions={})),function(Semantics){Semantics.Account="Account",Semantics["Address.Street"]="Address.Street",Semantics["Address.PostBox"]="Address.PostBox",Semantics["Address.ZipCode"]="Address.ZipCode",Semantics["Address.City"]="Address.City",Semantics["Address.Country"]="Address.Country",Semantics["Address.SubRegion"]="Address.SubRegion",Semantics["Address.Region"]="Address.Region",Semantics["Amount.CurrencyCode"]="Amount.CurrencyCode",Semantics["BusinessDate.At"]="BusinessDate.At",Semantics["BusinessDate.From"]="BusinessDate.From",Semantics["BusinessDate.To"]="BusinessDate.To",Semantics.Calendar="Calendar",Semantics["Calendar.Year"]="Calendar.Year",Semantics["Calendar.Quarter"]="Calendar.Quarter",Semantics["Calendar.Month"]="Calendar.Month",Semantics["Calendar.Week"]="Calendar.Week",Semantics["Calendar.Day"]="Calendar.Day",Semantics.CurrencyCode="CurrencyCode",Semantics.Language="Language",Semantics.Geography="Geography",Semantics["GeoLocation.Latitude"]="GeoLocation.Latitude",Semantics["GeoLocation.Longitude"]="GeoLocation.Longitude",Semantics["Quantity.UnitOfMeasure"]="Quantity.UnitOfMeasure",Semantics.Text="Text",Semantics.UnitOfMeasure="UnitOfMeasure"}(semantics_Semantics||(semantics_Semantics={}));Object.values(semantics_Semantics).filter((value=>value.startsWith("Calendar")));var OperationGroupingType,CriticalityRepresentationType;!function(OperationGroupingType){OperationGroupingType[OperationGroupingType.Isolated=0]="Isolated",OperationGroupingType[OperationGroupingType.ChangeSet=1]="ChangeSet"}(OperationGroupingType||(OperationGroupingType={})),function(CriticalityRepresentationType){CriticalityRepresentationType[CriticalityRepresentationType.WithIcon=0]="WithIcon",CriticalityRepresentationType[CriticalityRepresentationType.WithoutIcon=1]="WithoutIcon",CriticalityRepresentationType[CriticalityRepresentationType.OnlyIcon=2]="OnlyIcon"}(CriticalityRepresentationType||(CriticalityRepresentationType={}));var ValueListParameterType;!function(ValueListParameterType){ValueListParameterType.InOut="InOut",ValueListParameterType.DisplayOnly="DisplayOnly"}(ValueListParameterType||(ValueListParameterType={}));var v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js");const types_C_MEASURES="Measures",C_MEASURES_CAPTION=`[${types_C_MEASURES}]_Text`;var Syntax,DisplayBehaviour,AnnotationTerm,Drill,FilterSelectionType,types_FilterOperator,FilteringLogic,AdvancedSlicerOperator;!function(Syntax){Syntax.SQL="SQL",Syntax.JSON="JSON",Syntax.MDX="MDX"}(Syntax||(Syntax={})),function(DisplayBehaviour){DisplayBehaviour.descriptionAndId="descriptionAndId",DisplayBehaviour.descriptionOnly="descriptionOnly",DisplayBehaviour.idAndDescription="idAndDescription",DisplayBehaviour.idOnly="idOnly",DisplayBehaviour.auto=""}(DisplayBehaviour||(DisplayBehaviour={})),function(AnnotationTerm){AnnotationTerm.RelatedRecursiveHierarchy="RelatedRecursiveHierarchy",AnnotationTerm.ValueList="ValueList",AnnotationTerm.SelectionFields="SelectionFields"}(AnnotationTerm||(AnnotationTerm={})),function(Drill){Drill[Drill.Children=0]="Children",Drill[Drill.SelfAndChildren=1]="SelfAndChildren",Drill[Drill.Descendants=2]="Descendants",Drill[Drill.SelfAndDescendants=3]="SelfAndDescendants",Drill[Drill.Siblings=4]="Siblings",Drill[Drill.Leaves=5]="Leaves",Drill[Drill.Ancestor=6]="Ancestor"}(Drill||(Drill={})),function(FilterSelectionType){FilterSelectionType.Multiple="Multiple",FilterSelectionType.Single="Single",FilterSelectionType.SingleInterval="SingleInterval",FilterSelectionType.SingleRange="SingleRange"}(FilterSelectionType||(FilterSelectionType={})),function(FilterOperator){FilterOperator.BT="BT",FilterOperator.EQ="EQ",FilterOperator.GE="GE",FilterOperator.GT="GT",FilterOperator.LE="LE",FilterOperator.LT="LT",FilterOperator.NE="NE",FilterOperator.Contains="Contains",FilterOperator.EndsWith="EndsWith",FilterOperator.StartsWith="StartsWith"}(types_FilterOperator||(types_FilterOperator={})),function(FilteringLogic){FilteringLogic[FilteringLogic.And=0]="And",FilteringLogic[FilteringLogic.Or=1]="Or"}(FilteringLogic||(FilteringLogic={})),function(AdvancedSlicerOperator){AdvancedSlicerOperator.Equal="Equal",AdvancedSlicerOperator.NotEqual="NotEqual",AdvancedSlicerOperator.LessThan="LessThan",AdvancedSlicerOperator.GreaterThan="GreaterThan",AdvancedSlicerOperator.LessEqual="LessEqual",AdvancedSlicerOperator.GreaterEqual="GreaterEqual",AdvancedSlicerOperator.Between="Between",AdvancedSlicerOperator.NotBetween="NotBetween",AdvancedSlicerOperator.TopCount="TopCount",AdvancedSlicerOperator.BottomCount="BottomCount",AdvancedSlicerOperator.TopPercent="TopPercent",AdvancedSlicerOperator.BottomPercent="BottomPercent",AdvancedSlicerOperator.TopSum="TopSum",AdvancedSlicerOperator.BottomSum="BottomSum"}(AdvancedSlicerOperator||(AdvancedSlicerOperator={}));const isBaseProperty=toBe=>!isNil_isNil(toBe?.dimension),types_isDimension=toBe=>!isNil_isNil(toBe?.dimension)&&toBe.dimension!==types_C_MEASURES,types_isMeasure=toBe=>toBe?.dimension===types_C_MEASURES,isMeasureName=toBe=>toBe.startsWith(`[${types_C_MEASURES}].`),isSlicer=toBe=>!isNil_isNil(toBe?.dimension)&&!isNil_isNil(toBe?.members),isFilter=toBe=>!(isNil_isNil(toBe?.dimension)&&isNil_isNil(toBe?.dimension)||isNil_isNil(toBe?.operator)),isAdvancedFilter=toBe=>!isNil_isNil(toBe?.filteringLogic),isAdvancedSlicer=toBe=>!isNil_isNil(AdvancedSlicerOperator[toBe?.operator]);function getPropertyName(path){return isString_isString(path)?isMeasureName(path)?function getMeasureName(path){if(isString_isString(path))return isMeasureName(path)?path.replace(/^\[Measures\]\.\[/g,"").replace(/\]$/g,""):path;return path?.measure}(path):path:types_isDimension(path)?path?.dimension:path?.measure}function getPropertyHierarchy(path){return isString_isString(path)?path:types_isDimension(path)?path?.hierarchy||path?.dimension:null}function getPropertyMeasure(path){return isString_isString(path)?path:path?.measure}function uuid(){return(0,v4.A)()}function displayByBehaviour(option,behaviour){switch(behaviour){case DisplayBehaviour.descriptionAndId:return`${option.caption||option.label||""} (#${option.key||option.value})`;case DisplayBehaviour.descriptionOnly:return`${option.caption||option.label||""}`;case DisplayBehaviour.idAndDescription:return`#${option.key||option.value} (${option.caption||option.label||""})`;case DisplayBehaviour.idOnly:return`${option.key||option.value}`;default:return`${option.caption||option.label||option.key||option.value}`}}function formatting(value,formatting,locale){let num="";try{value=strToNumber(value)}catch(err){return"NaN"}if("%"===formatting?.unit&&(value*=100),formatting?.shortNumber){const[n,unit]=function formatShortNumber(value,locale="en",factor,shortUnits){try{const num=strToNumber(value),localeData=FORMAT_LOCALE_DATA[locale];factor=factor||localeData?.shortNumberFactor;let resultValue=num,resultName="";const units=(shortUnits=shortUnits||localeData?.shortNumberUnits).split(",").reverse();return units.every(((unitName,i)=>{const rounder=Math.pow(10,(units.length-i)*factor);return!(Math.abs(num)>=rounder&&(resultValue=num/rounder,resultName=unitName,1))})),[Number(resultValue),resultName]}catch(error){throw new Error("Invalid Short Number Argument")}}(value,locale,formatting?.decimal);num=formatNumber(n,locale,formatting?.digitsInfo)+unit}else num=formatNumber(value,locale,formatting?.digitsInfo);return"%"===formatting?.unit&&(num+="%"),num}var calculated_CalculationType,AggregationOperation,CompareToEnum,ParameterControlEnum;!function(CalculationType){CalculationType.Restricted="Restricted",CalculationType.Calculated="Calculated",CalculationType.Aggregation="Aggregation",CalculationType.Variance="Variance",CalculationType.D2Measure="D2Measure",CalculationType.MeasureControl="MeasureControl",CalculationType.Parameter="Parameter",CalculationType.Indicator="Indicator"}(calculated_CalculationType||(calculated_CalculationType={})),function(AggregationOperation){AggregationOperation.SUM="SUM",AggregationOperation.COUNT="COUNT",AggregationOperation.MIN="MIN",AggregationOperation.MAX="MAX",AggregationOperation.AVERAGE="AVERAGE",AggregationOperation.STDEV="STDEV",AggregationOperation.STDEVP="STDEVP",AggregationOperation.MEDIAN="MEDIAN",AggregationOperation.TOP_PERCENT="TOP_PERCENT",AggregationOperation.TOP_COUNT="TOP_COUNT",AggregationOperation.TOP_SUM="TOP_SUM"}(AggregationOperation||(AggregationOperation={})),function(CompareToEnum){CompareToEnum.CurrentMember="CurrentMember",CompareToEnum.SelectedMember="SelectedMember",CompareToEnum.Lag="Lag",CompareToEnum.Lead="Lead",CompareToEnum.Parallel="Parallel",CompareToEnum.Ancestor="Ancestor"}(CompareToEnum||(CompareToEnum={})),function(ParameterControlEnum){ParameterControlEnum[ParameterControlEnum.Input=0]="Input",ParameterControlEnum[ParameterControlEnum.Select=1]="Select",ParameterControlEnum[ParameterControlEnum.Dimensions=2]="Dimensions"}(ParameterControlEnum||(ParameterControlEnum={}));const isCalculationProperty=toBe=>!isNil_isNil(toBe?.calculationType),isCalculatedProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Calculated,isAggregationProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Aggregation,isRestrictedMeasureProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Restricted,isVarianceMeasureProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Variance,isMeasureControlProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.MeasureControl,calculated_isIndicatorMeasureProperty=toBe=>isCalculationProperty(toBe)&&toBe.calculationType===calculated_CalculationType.Indicator,isParameterProperty=toBe=>!isNil_isNil(toBe?.paramType);function getMeasurePropertyUnit(property){return isVarianceMeasureProperty(property)&&property.asPercentage?"%":property?.formatting?.unit}function parameterFormatter(name){return`[@${name}]`}const AggregationOperations=[{value:AggregationOperation.SUM,label:"Sum"},{value:AggregationOperation.COUNT,label:"Count"},{value:AggregationOperation.MIN,label:"Min"},{value:AggregationOperation.MAX,label:"Max"},{value:AggregationOperation.AVERAGE,label:"Average"},{value:AggregationOperation.STDEV,label:"Standard Deviation"},{value:AggregationOperation.STDEVP,label:"Population Standard Deviation"},{value:AggregationOperation.MEDIAN,label:"Median"},{value:AggregationOperation.TOP_PERCENT,label:"Top Percent"},{value:AggregationOperation.TOP_COUNT,label:"Top Count"},{value:AggregationOperation.TOP_SUM,label:"Top Sum"}];var MemberType;!function(MemberType){MemberType[MemberType.MDMEMBER_TYPE_REGULAR=1]="MDMEMBER_TYPE_REGULAR",MemberType[MemberType.MDMEMBER_TYPE_ALL=2]="MDMEMBER_TYPE_ALL",MemberType[MemberType.MDMEMBER_TYPE_FORMULA=3]="MDMEMBER_TYPE_FORMULA",MemberType[MemberType.MDMEMBER_TYPE_MEASURE=4]="MDMEMBER_TYPE_MEASURE",MemberType[MemberType.MDMEMBER_TYPE_UNKNOWN=5]="MDMEMBER_TYPE_UNKNOWN"}(MemberType||(MemberType={}));const DimensionMemberRecursiveHierarchy={parentNodeProperty:"parentKey",externalKeyProperty:"memberUniqueName",valueProperty:"memberKey",labelProperty:"memberCaption",levelProperty:"levelNumber",descendantCountProperty:"childrenCardinality",memberTypeProperty:"memberType"};var IntrinsicMemberProperties,property_AggregationRole,DataType;function serializeUniqueName(dimension,hierarchy,level,intrinsic){const name=hierarchy&&dimension!==hierarchy?`[${dimension}.${hierarchy}]`:`[${dimension}]`;return intrinsic?`${name}.[${level}].[${intrinsic}]`:level?`${name}.[${level}]`:name}function getEntityProperty(entityType,path){const name=getPropertyName(path);return entityType?.properties[name]??entityType?.parameters?.[name]}function helper_getEntityProperty2(entityType,path){return isString_isString(path)?Object.values(entityType?.properties??{}).reduce(((prev,dimension)=>prev??(dimension.name===path?dimension:dimension.hierarchies?.reduce(((prev,hierarchy)=>prev??(hierarchy.name===path?hierarchy:hierarchy.levels?.reduce(((prev,level)=>prev??(level.name===path?level:null)),null))),null))),null)??entityType?.parameters?.[path]:types_isMeasure(path)?entityType?.properties[path.measure]:Object.values(entityType?.properties??{}).reduce(((prev,dimension)=>prev??(dimension.name===path.dimension?path.hierarchy?dimension.hierarchies?.reduce(((prev,hierarchy)=>prev??(hierarchy.name===path.hierarchy?path.level?hierarchy.levels?.reduce(((prev,level)=>prev??(level.name===path.level?level:null)),null):hierarchy:null)),null):dimension:null)),null)??entityType?.parameters?.[path.dimension]}function helper_getEntityDimensions(entityType){return isNil_isNil(entityType?.properties)?[]:Object.values(entityType?.properties).filter((item=>item.role===property_AggregationRole.dimension&&isVisible(item)))}function getEntityDimensionAndHierarchies(entityType){if(isNil_isNil(entityType?.properties))return[];const results=[];return Object.values(entityType.properties).forEach((property=>{property.role===property_AggregationRole.dimension&&(results.push(property),property.hierarchies?.forEach((hierarchy=>{results.push(hierarchy)})))})),results}function helper_getEntityMeasures(entityType){return isNil_isNil(entityType?.properties)?[]:Object.values(entityType.properties).filter((property=>property.role===property_AggregationRole.measure&&isVisible(property)))}function getEntityDefaultMeasure(entityType){return entityType.defaultMeasure?entityType.properties[entityType.defaultMeasure]:helper_getEntityMeasures(entityType)[0]}function getEntityHierarchy(entityType,params){if(isNil_isNil(entityType?.properties)||isNil_isNil(params))return null;const{dimension,hierarchy}=isString_isString(params)?{dimension:null,hierarchy:params}:params;return Object.values(entityType.properties).reduce(((prev,item)=>prev??(dimension&&item.name!==dimension?null:item.hierarchies?.find((hier=>hier.name===(hierarchy||dimension))))),null)}function getEntityLevel(entityType,dimension){return entityType?.properties&&dimension&&Object.values(entityType.properties).find((item=>item.name===dimension.dimension))?.hierarchies?.find((item=>item.name===(dimension.hierarchy||dimension.dimension)))?.levels?.find((item=>item.name===dimension.level))}function getEntityCalculations(entityType){return isNil_isNil(entityType?.properties)?[]:Object.values(entityType.properties).filter((property=>isCalculationProperty(property)))}function getEntityParameters(entityType){return isNil_isNil(entityType?.parameters)?[]:Object.values(entityType.parameters)}function helper_getEntityVariables(entityType){return getEntityParameters(entityType).filter((parameter=>parameter.role===property_AggregationRole.variable))}function _getPropertyCaption(property){return property?.caption}function getDimensionMemberCaption(dimension,entityType){if(isNil_isNil(dimension))return null;if(dimension.memberCaption)return IntrinsicMemberProperties[dimension.memberCaption]?`${getPropertyHierarchy(dimension)}.[${dimension.memberCaption}]`:dimension.memberCaption;if(entityType){const property=getEntityProperty(entityType,dimension);return property?.memberCaption}return null}function getDimensionDisplayBehaviour(dimension){return types_isDimension(dimension)?dimension.displayBehaviour:null}function getPropertyUnitName(property){return isString_isString(property?.unit)?property.unit:property?.unit?.name}function isSemanticCalendar(property){return property?.semantics?.semantic&&semantics_Semantics[property.semantics.semantic]?.startsWith("Calendar")}function stringifyProperty(path){return isString_isString(path)?path:types_isDimension(path)?`${path.level||path.hierarchy||path.dimension}`:path.measure}function parseDimension(name,entityType){const d={};return isNil_isNil(entityType?.properties)?null:(Object.values(entityType.properties).find((dimension=>dimension.name===name?(d.dimension=name,!0):dimension.hierarchies?.find((hierarchy=>hierarchy.name===name?(d.dimension=dimension.name,d.hierarchy=name,!0):hierarchy.levels?.find((level=>level.name===name&&(d.dimension=dimension.name,d.hierarchy=hierarchy.name,d.level=name,!0))))))),d)}function isVisible(property){return property.visible||isNil_isNil(property.visible)}function getEntityCalendarHierarchy(entityType,{dimension,hierarchy}){const dProperty=getEntityProperty(entityType,dimension);if(!dProperty)throw new Error(`Dimension '${dimension}' not found in '${entityType.caption||entityType.name}'`);if(hierarchy)return dProperty.hierarchies?.find((item=>item.name===hierarchy));const defaultHierarchy=dProperty.hierarchies?.find((item=>item.name===dProperty.defaultHierarchy));return defaultHierarchy??dProperty.hierarchies?.[0]}function mergeEntityType(a,b){return assignDeepOmitBlank(a,b,5)}function convertSlicerToDimension(slicer){return slicer?.dimension?{...slicer.dimension,members:slicer.members,exclude:slicer.exclude}:null}function convertDimensionToSlicer(dimension){return{dimension:omit_omit(dimension,"members","exclude"),members:dimension.members,exclude:dimension.exclude}}function getMemberFromRow(row,dimension,entityType){const caption=getDimensionMemberCaption(dimension,entityType);return{key:row[dimension.hierarchy||dimension.dimension],value:row[dimension.hierarchy||dimension.dimension],label:caption?row[caption]:null,caption:caption?row[caption]:null}}function helper_getDefaultHierarchy(property){return property?.hierarchies?.find((hierarchy=>hierarchy.name===property.defaultHierarchy))||property?.hierarchies?.[0]}function isWrapBrackets(name){return name?.match(/\[.*\]/g)}function helper_wrapBrackets(name){return name&&!isWrapBrackets(name)?`[${name}]`:name}function unwrapBrackets(name){const m=name?.match(/\[(.*)\]/);return m?m[1]:name}function wrapHierarchyValue(hierarchy,value){return value.startsWith(hierarchy)?value:`${hierarchy}.${helper_wrapBrackets(value)}`}!function(IntrinsicMemberProperties){IntrinsicMemberProperties.Unkown="Unkown",IntrinsicMemberProperties.CATALOG_NAME="CATALOG_NAME",IntrinsicMemberProperties.DESCRIPTION="DESCRIPTION",IntrinsicMemberProperties.PARENT_UNIQUE_NAME="PARENT_UNIQUE_NAME",IntrinsicMemberProperties.MEMBER_UNIQUE_NAME="MEMBER_UNIQUE_NAME",IntrinsicMemberProperties.MEMBER_CAPTION="MEMBER_CAPTION",IntrinsicMemberProperties.MEMBER_TYPE="MEMBER_TYPE",IntrinsicMemberProperties.LEVEL_NUMBER="LEVEL_NUMBER",IntrinsicMemberProperties.CHILDREN_CARDINALITY="CHILDREN_CARDINALITY"}(IntrinsicMemberProperties||(IntrinsicMemberProperties={})),function(AggregationRole){AggregationRole.dimension="dimension",AggregationRole.hierarchy="hierarchy",AggregationRole.level="level",AggregationRole.measure="measure",AggregationRole.text="text",AggregationRole.variable="variable"}(property_AggregationRole||(property_AggregationRole={})),function(DataType){DataType.Unknown="Unknown",DataType.Numeric="Numeric",DataType.Integer="Integer",DataType.String="String",DataType.Boolean="Boolean",DataType.Date="Date",DataType.Datetime="Datetime",DataType.Time="Time",DataType.Timestamp="Timestamp"}(DataType||(DataType={}));const isPropertyDimension=toBe=>toBe?.role===property_AggregationRole.dimension,isPropertyHierarchy=toBe=>toBe?.role===property_AggregationRole.hierarchy,isPropertyLevel=toBe=>toBe?.role===property_AggregationRole.level,isPropertyMeasure=toBe=>toBe?.role===property_AggregationRole.measure,isEntityType=toBe=>!(toBe instanceof Error||isNil_isNil(toBe?.name)),isEntitySet=toBe=>!(toBe instanceof Error||isNil_isNil(toBe?.name));var EntitySemantics,DimensionType,TimeLevelType,sdl_RuntimeLevelType,sdl_VariableEntryType,VariableSelectionType;!function(EntitySemantics){EntitySemantics.aggregate="aggregate",EntitySemantics.parameters="parameters",EntitySemantics.table="table",EntitySemantics.view="view"}(EntitySemantics||(EntitySemantics={})),function(DimensionType){DimensionType.StandardDimension="StandardDimension",DimensionType.TimeDimension="TimeDimension",DimensionType.MeasuresDimension="MeasuresDimension"}(DimensionType||(DimensionType={})),function(TimeLevelType){TimeLevelType.TimeYears="TimeYears",TimeLevelType.TimeQuarters="TimeQuarters",TimeLevelType.TimeMonths="TimeMonths",TimeLevelType.TimeWeeks="TimeWeeks",TimeLevelType.TimeDays="TimeDays"}(TimeLevelType||(TimeLevelType={})),function(RuntimeLevelType){RuntimeLevelType[RuntimeLevelType.REGULAR=0]="REGULAR",RuntimeLevelType[RuntimeLevelType.ALL=1]="ALL",RuntimeLevelType[RuntimeLevelType.CALCULATED=2]="CALCULATED",RuntimeLevelType[RuntimeLevelType.TIME_YEAR=20]="TIME_YEAR",RuntimeLevelType[RuntimeLevelType.TIME_QUARTER=68]="TIME_QUARTER",RuntimeLevelType[RuntimeLevelType.TIME_MONTH=132]="TIME_MONTH",RuntimeLevelType[RuntimeLevelType.TIME_WEEK=260]="TIME_WEEK",RuntimeLevelType[RuntimeLevelType.TIME_DAY=516]="TIME_DAY"}(sdl_RuntimeLevelType||(sdl_RuntimeLevelType={})),function(VariableEntryType){VariableEntryType[VariableEntryType.Default=0]="Default",VariableEntryType[VariableEntryType.Required=1]="Required"}(sdl_VariableEntryType||(sdl_VariableEntryType={})),function(VariableSelectionType){VariableSelectionType[VariableSelectionType.Default=0]="Default",VariableSelectionType[VariableSelectionType.Value=1]="Value",VariableSelectionType[VariableSelectionType.Interval=2]="Interval",VariableSelectionType[VariableSelectionType.Complex=3]="Complex"}(VariableSelectionType||(VariableSelectionType={}));const isVariableProperty=toBe=>toBe?.role===property_AggregationRole.variable;var IndicatorType,IndicatorTagEnum,TreeSelectionMode,PresentationEnum;function getIndicatorMeasureName(indicator){const name=indicator.code||indicator.name;return indicator.formula?name+"_formula":indicator.measure}!function(IndicatorType){IndicatorType.BASIC="BASIC",IndicatorType.DERIVE="DERIVE"}(IndicatorType||(IndicatorType={})),function(IndicatorTagEnum){IndicatorTagEnum[IndicatorTagEnum.UNIT=0]="UNIT",IndicatorTagEnum[IndicatorTagEnum.MOM=1]="MOM",IndicatorTagEnum[IndicatorTagEnum.YOY=2]="YOY"}(IndicatorTagEnum||(IndicatorTagEnum={})),function(TreeSelectionMode){TreeSelectionMode.Individual="Individual",TreeSelectionMode.SelfDescendants="SelfDescendants",TreeSelectionMode.DescendantsOnly="DescendantsOnly",TreeSelectionMode.SelfChildren="SelfChildren",TreeSelectionMode.ChildrenOnly="ChildrenOnly"}(TreeSelectionMode||(TreeSelectionMode={})),function(PresentationEnum){PresentationEnum[PresentationEnum.Flat=0]="Flat",PresentationEnum[PresentationEnum.Hierarchy=1]="Hierarchy"}(PresentationEnum||(PresentationEnum={}));var TimeGranularity,TimeRangeType,OffSetDirection,format=__webpack_require__("./node_modules/date-fns/format.mjs"),subYears=__webpack_require__("./node_modules/date-fns/subYears.mjs"),addYears=__webpack_require__("./node_modules/date-fns/addYears.mjs"),subQuarters=__webpack_require__("./node_modules/date-fns/subQuarters.mjs"),addQuarters=__webpack_require__("./node_modules/date-fns/addQuarters.mjs"),subMonths=__webpack_require__("./node_modules/date-fns/subMonths.mjs"),addMonths=__webpack_require__("./node_modules/date-fns/addMonths.mjs"),subWeeks=__webpack_require__("./node_modules/date-fns/subWeeks.mjs"),addWeeks=__webpack_require__("./node_modules/date-fns/addWeeks.mjs"),subDays=__webpack_require__("./node_modules/date-fns/subDays.mjs"),addDays=__webpack_require__("./node_modules/date-fns/addDays.mjs");!function(TimeGranularity){TimeGranularity.Year="Year",TimeGranularity.Quarter="Quarter",TimeGranularity.Month="Month",TimeGranularity.Week="Week",TimeGranularity.Day="Day"}(TimeGranularity||(TimeGranularity={})),function(TimeRangeType){TimeRangeType.Standard="Standard",TimeRangeType.Offset="Offset"}(TimeRangeType||(TimeRangeType={})),function(OffSetDirection){OffSetDirection.LookBack="LookBack",OffSetDirection.LookAhead="LookAhead"}(OffSetDirection||(OffSetDirection={}));const isTimeRangesSlicer=toBe=>!isNil_isNil(toBe?.ranges)&&!isNil_isNil(toBe?.currentDate);function mapTimeGranularitySemantic(granularity){switch(granularity){case TimeGranularity.Year:return semantics_Semantics["Calendar.Year"];case TimeGranularity.Quarter:return semantics_Semantics["Calendar.Quarter"];case TimeGranularity.Month:return semantics_Semantics["Calendar.Month"];case TimeGranularity.Day:return semantics_Semantics["Calendar.Day"];default:throw new Error(`Can't found semantics for granularity ${granularity}`)}}function formatCurrentPeriod(current,granularity,formatter){if(null===granularity||null===current)return null;let _format="yyyMMdd";switch(granularity){case TimeGranularity.Year:_format="yyyy";break;case TimeGranularity.Quarter:_format="yyyy'Q'Q";break;case TimeGranularity.Month:_format="yyyyMM";break;case TimeGranularity.Day:_format="yyyyMMdd"}return(0,format.GP)(current,formatter||_format)}function calcOffset(currentDate,{direction,granularity,amount}){switch(amount=amount||0,granularity){case TimeGranularity.Year:return direction===OffSetDirection.LookBack?(0,subYears.d)(currentDate,amount):(0,addYears.e)(currentDate,amount);case TimeGranularity.Quarter:return direction===OffSetDirection.LookBack?(0,subQuarters.c)(currentDate,amount):(0,addQuarters.z)(currentDate,amount);case TimeGranularity.Month:return direction===OffSetDirection.LookBack?(0,subMonths.a)(currentDate,amount):(0,addMonths.P)(currentDate,amount);case TimeGranularity.Week:return direction===OffSetDirection.LookBack?(0,subWeeks.k)(currentDate,amount):(0,addWeeks.J)(currentDate,amount);case TimeGranularity.Day:return direction===OffSetDirection.LookBack?(0,subDays.e)(currentDate,amount):(0,addDays.f)(currentDate,amount);default:return currentDate}}function formatRangeCurrentPeriod(current,range){return range.type===TimeRangeType.Offset&&(current=calcOffset(current,{...range.current,granularity:range.granularity})),formatCurrentPeriod(current,range.granularity,range.formatter)}function calcRange(current,range){let from=range.lookBack??-range.lookAhead,to=range.lookAhead??-range.lookBack;return range.type===TimeRangeType.Offset&&(current=calcOffset(current,{...range.current,granularity:range.granularity}),from=range.lookBack??1,to=range.lookAhead??-1),[formatCurrentPeriod(calcOffset(current,{direction:OffSetDirection.LookBack,granularity:range.granularity,amount:from}),range.granularity,range.formatter),formatCurrentPeriod(calcOffset(current,{direction:OffSetDirection.LookAhead,granularity:range.granularity,amount:to}),range.granularity,range.formatter)]}function timeRangesSlicerAsString(slicer,i18nTimeRanges){return`${i18nTimeRanges??"Time Ranges"}: ${slicer.ranges.map((range=>`${range.type}|${range.granularity}${range.type===TimeRangeType.Offset?`(${range.current?.direction??""}:${range.current?.amount??0}):[${isNil_isNil(range.lookBack)?1:-range.lookBack}, ${isNil_isNil(range.lookAhead)?-1:range.lookAhead}]`:`:[${isNil_isNil(range.lookBack)?range.lookAhead??0:-range.lookBack}, ${isNil_isNil(range.lookAhead)?-(range.lookBack??0):range.lookAhead}]`}`)).join(" & ")}`}class AbstractEntityService{get entityType(){return this._entityType$.value}constructor(dataSource,entitySet){this.dataSource=dataSource,this.entitySet=entitySet,this.destroySubject$=new Subject.B,this.destroy$=this.destroySubject$.asObservable(),this.registerMeasures$=new BehaviorSubject.t({}),this._entityType$=new BehaviorSubject.t(null),this.entityType$=this._entityType$.pipe((0,filter.p)((entityType=>!!entityType))),this.__id__=uuid(),(0,combineLatest.z)([this.dataSource.selectEntityType(this.entitySet),this.registerMeasures$]).pipe((0,map.T)((([entityType,registerMeasures])=>isEntityType(entityType)?{...entityType,properties:{...entityType.properties,...registerMeasures}}:(console.error(entityType),entityType))),(0,filter.p)(isEntityType),(0,takeUntil.Q)(this.destroy$)).subscribe((entityType=>{this._entityType$.next(entityType)}))}getMembers(property){return this.dataSource.getMembers(this.entitySet,property)}selectMembers(property){return this.dataSource.selectMembers(this.entitySet,property)}selectEntityType(){return this.entityType$}getAnnotation(term,qualifier){return(0,observable_of.of)(null)}getIndicator(id){return this.dataSource.getIndicator(id,this.entitySet)}registerMeasure(name,property){const registerMeasures=this.registerMeasures$.value;this.registerMeasures$.next({...registerMeasures,[name]:property})}onDestroy(){this.destroySubject$.next(),this.destroySubject$.complete()}}var types_AgentType,types_AgentStatusEnum;!function(AgentType){AgentType.Local="local",AgentType.Browser="browser",AgentType.Server="server",AgentType.Wasm="wasm"}(types_AgentType||(types_AgentType={})),function(AgentStatusEnum){AgentStatusEnum.Initializing="Initializing",AgentStatusEnum.OFFLINE="offline",AgentStatusEnum.ONLINE="online",AgentStatusEnum.LOADING="loading",AgentStatusEnum.ERROR="error"}(types_AgentStatusEnum||(types_AgentStatusEnum={}));var asyncToGenerator=__webpack_require__("./node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),money_clip_m=__webpack_require__("./node_modules/money-clip/dist/money-clip.m.js"),dist=__webpack_require__("./node_modules/idb-keyval/dist/index.js");const CACHE_OPTIONS={level:3};class DSCacheService{constructor(options){this.options={maxAge:36e5,level:3},this.options=options??this.options}clearAllCache(){(0,dist.IU)()}changeCacheLevel(level){CACHE_OPTIONS.level=level}getCacheLevel(){return CACHE_OPTIONS.level}getCache({key:cacheKey,level,version,maxAge},{skip}={}){var _this=this;return(0,asyncToGenerator.A)((function*(){return level<=_this.options.level&&!skip?(0,money_clip_m.Jt)(cacheKey,{version,maxAge}):null}))()}setCache({key,level,version,maxAge},data){data&&level<=this.options.level&&(0,money_clip_m.hZ)(key,data,{version,maxAge})}keys(customStore){return(0,asyncToGenerator.A)((function*(){return(0,dist.HP)(customStore)}))()}clear(key,customStore){return(0,asyncToGenerator.A)((function*(){return(0,dist.yH)(key,customStore)}))()}}var AuthenticationMethod,ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),switchMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/switchMap.js"),shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js"),empty=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/empty.js");!function(AuthenticationMethod){AuthenticationMethod.none="none",AuthenticationMethod.basic="basic",AuthenticationMethod.saml="saml",AuthenticationMethod.independent="independent"}(AuthenticationMethod||(AuthenticationMethod={}));class AbstractDataSource{get options(){return this.options$.value}constructor(options,agent,cacheService){this.agent=agent,this.cacheService=cacheService,this.id=uuid(),this.destroySubject$=new ReplaySubject.m(1),this.destroy$=this.destroySubject$.asObservable(),this.options$=new BehaviorSubject.t(null),this._entitySets={},this.options$.next(options)}setSchema(schema){this.options$.next({...this.options$.value,schema})}updateCube(cube){const schema=this.options.schema??{},cubes=schema.cubes?[...schema.cubes]:[],index=cubes.findIndex((item=>item.__id__===cube.__id__));index>-1?cubes.splice(index,1,cube):cubes.push(cube),this.options$.next({...this.options$.value,schema:{...schema,cubes}})}upsertIndicator(indicator){const indicators=this.options.schema?.indicators?[...this.options.schema.indicators]:[],index=indicators.findIndex((item=>item.code===indicator.code));index>-1?indicators[index]={...indicators[index],...indicator}:indicators.push({...indicator});const schema=this.options.schema?{...this.options.schema}:{};schema.indicators=indicators,this.setSchema(schema)}selectSchema(){return this.options$.pipe((0,distinctUntilChanged.F)(),(0,map.T)((options=>options?.schema)),(0,distinctUntilChanged.F)(isEqual))}setEntityType(entityType){const schema=this.options.schema??{},entitySets=schema.entitySets??{};entitySets[entityType.name]=entitySets[entityType.name]??{name:entityType.name},entitySets[entityType.name].entityType=entityType,this.options$.next({...this.options,schema:{...schema,entitySets}})}selectEntitySet(entity){return this._entitySets[entity]||(this._entitySets[entity]=this.getEntityType(entity).pipe((0,switchMap.n)((rtEntityType=>isEntityType(rtEntityType)?this.selectSchema().pipe((0,distinctUntilChanged.F)(),(0,map.T)((schema=>{const indicators=schema?.indicators?.filter((indicator=>indicator.entity===entity));indicators?.forEach((indicator=>{mapIndicatorToMeasures(indicator).forEach((measure=>{rtEntityType.properties[measure.name]={...measure,role:property_AggregationRole.measure}}))}));const customEntityType=schema?.entitySets?.[entity]?.entityType;let entityType=rtEntityType;return isNil_isNil(customEntityType)||(entityType=mergeEntityType(assign_assign({},rtEntityType),customEntityType)),entityType&&(entityType.dialect=this.options.dialect,entityType.syntax=this.options.syntax),{name:entityType.name,caption:entityType.caption,entityType,indicators}}))):(0,observable_of.of)(rtEntityType))),(0,takeUntil.Q)(this.destroy$),(0,shareReplay.t)(1))),this._entitySets[entity]}selectEntityType(entity){return entity?this.selectEntitySet(entity).pipe((0,map.T)((entitySet=>isEntitySet(entitySet)?entitySet.entityType:entitySet))):empty.w}selectIndicators(entity){return this.selectEntitySet(entity).pipe((0,filter.p)(isEntitySet),(0,map.T)((entitySet=>entitySet.indicators)),(0,distinctUntilChanged.F)())}getIndicator(id,entity){return this.options.schema?.indicators?.find((indicator=>(indicator.id===id||indicator.code===id)&&indicator.entity===entity))}clearCache(key=""){var _this=this;return(0,asyncToGenerator.A)((function*(){return yield _this.cacheService.clear(key)}))()}onDestroy(){this.destroySubject$.next(),this.destroySubject$.complete()}}function mapIndicatorToMeasures(indicator){const measures=[],name=indicator.code||indicator.name,measureName=getIndicatorMeasureName(indicator);return indicator.formula&&measures.push({name:measureName,caption:indicator.name,dataType:indicator.dataType||DataType.Unknown,role:property_AggregationRole.measure,calculationType:calculated_CalculationType.Calculated,formula:indicator.formula,aggregator:indicator.aggregator,hidden:!0,visible:!1}),measures.push({name,caption:indicator.name,dataType:indicator.dataType||DataType.Unknown,role:property_AggregationRole.measure,calculationType:calculated_CalculationType.Indicator,measure:measureName,dimensions:indicator.filters?.map(convertSlicerToDimension),slicers:indicator.filters,enableConstantSelection:!0,formatting:{unit:indicator.unit},aggregator:indicator.aggregator,visible:indicator.visible}),measures}var src=__webpack_require__("./packages/store/src/index.ts");class DSCoreService extends src.jh{#dataSources;constructor(agents,dataSources,factories,cacheService){super({dataSources}),this.agents=agents,this.factories=factories,this.cacheService=cacheService,this.timeGranularity$=this.select((state=>state.timeGranularity)),this.currentTime$=(0,combineLatest.z)([this.select((state=>state.today)),this.timeGranularity$]).pipe((0,map.T)((([today,timeGranularity])=>({today,timeGranularity})))),this._dataSources=new Map,this.#dataSources=new Map,this.registerModel=this.updater(((state,model)=>{model.useLocalAgent&&(model.agentType=model.agentType??types_AgentType.Local),state.dataSources=state.dataSources??[];const index=state.dataSources.findIndex((item=>item.key===model.key));index>-1?state.dataSources.splice(index,1,model):state.dataSources.push(model)}))}getDataSource(key){return this._dataSources.get(key)||this._dataSources.set(key,this.select((state=>state.dataSources?.find((item=>item.key===key)))).pipe((0,filter.p)((value=>!!value)),(0,switchMap.n)((options=>this.createDataSource(options))),(0,shareReplay.t)(1))),this._dataSources.get(key)}_getDataSource(key){var _this=this;return(0,asyncToGenerator.A)((function*(){if(!_this.#dataSources.has(key)){const options=_this.get((state=>state.dataSources?.find((item=>item.key===key))));if(!options)throw new Error(`Can't found dataSource for: '${key}'`);_this.#dataSources.set(key,yield _this.createDataSource(options))}return _this.#dataSources.get(key)}))()}createDataSource(options){var _this2=this;return(0,asyncToGenerator.A)((function*(){const provider=_this2.factories.find((({type})=>type===options?.type));if(!provider)throw new Error(`Can't found provider for dataSource type: '${options.type}'`);const agent=_this2.agents.find((item=>item.type===options.agentType));if(!agent)throw new Error(`Can't found Agent for type '${options.agentType}'`);return new(yield provider.factory())(options,agent,_this2.cacheService)}))()}getEntityService(dataSource,entitySet){return this.getDataSource(dataSource).pipe((0,map.T)((dataSource=>dataSource.createEntityService(entitySet))))}getEntitySet(dataSource,entity){return this.selectEntitySet(dataSource,entity)}selectEntitySet(dataSource,entity){return this.getDataSource(dataSource).pipe((0,switchMap.n)((dataSource=>dataSource.selectEntitySet(entity).pipe((0,filter.p)(isEntitySet)))))}setTimeGranularity(timeGranularity){this.patchState({timeGranularity})}setToday(today){this.patchState({today})}getToday(){return this.get((state=>({today:state.today,timeGranularity:state.timeGranularity})))}}var isDate=__webpack_require__("./node_modules/date-fns/isDate.mjs");const HTML5_FMT_DATE="yyyy-MM-dd";var FilterMergeMode;function putFilter(filters,value,mode){if(isArray_isArray(value))return value.forEach((item=>{filters=putFilter(filters,item,mode)})),filters;let existed=!1;const ftrs=(filters||[]).map((item=>existed?item:item.dimension&&getPropertyHierarchy(item.dimension)===getPropertyHierarchy(value.dimension)?(existed=!0,item.dimension.name===value.dimension.name?value:mode===FilterMergeMode.ignore?item:(FilterMergeMode.merge,value)):isAdvancedSlicer(value)&&isAdvancedSlicer(item)?(existed=!0,value):item));return existed||ftrs.push(value),ftrs}function slicerAsString(slicer){if(isAdvancedFilter(slicer))return`[${slicer.children.map((item=>slicerAsString(item))).join(slicer.filteringLogic===FilteringLogic.And?" & ":", ")}]`;if(isFilter(slicer)){const value=getValueString(slicer.members[0]?.key);switch(slicer.operator){case types_FilterOperator.BT:return`${slicer.members[0]?.key}...${slicer.members[1]?.key}`;case types_FilterOperator.EQ:return slicer.members.map((member=>`${member.caption||getValueString(member.key)}`)).join(", ");case types_FilterOperator.NE:return`≠${value}`;case types_FilterOperator.LT:return`<${value}`;case types_FilterOperator.LE:return`≤${value}`;case types_FilterOperator.GT:return`>${value}`;case types_FilterOperator.GE:return`≥${value}`;case types_FilterOperator.Contains:return`*${value}*`;case types_FilterOperator.EndsWith:return`*${value}`;case types_FilterOperator.StartsWith:return`${value}*`;default:return""}}return(slicer.exclude?"≠":"")+(slicer.members?.map((member=>`${member.caption||getValueString(member.key)}`)).join(", ")??"")}function getValueString(value){return(0,isDate.$)(value)?(0,format.GP)(value,HTML5_FMT_DATE):isString_isString(value)?value?value.startsWith("datetime")?value:`'${value}'`:"":`${value}`}!function(FilterMergeMode){FilterMergeMode[FilterMergeMode.ignore=0]="ignore",FilterMergeMode[FilterMergeMode.replace=1]="replace",FilterMergeMode[FilterMergeMode.merge=2]="merge"}(FilterMergeMode||(FilterMergeMode={}));const FILTER_OPERATOR_DESC={All:"空",BT:"介于",EQ:"等于",GE:"大于等于",GT:"大于",LE:"小于等于",LT:"小于",NE:"不等于",Contains:"包含",StartsWith:"开始于",EndsWith:"结束于"};function advancedSlicerAsString(slicer,i18nOnContext){return`${slicer.operator}(${isArray_isArray(slicer.value)?compact(slicer.value):slicer.value},${slicer.measure}) ${i18nOnContext??"on context"}:(${slicer.context.map((({dimension})=>dimension))})`}var OrderDirection;!function(OrderDirection){OrderDirection.ASC="ASC",OrderDirection.DESC="DESC"}(OrderDirection||(OrderDirection={}));var catchError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),tap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/tap.js"),delayWhen=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/delayWhen.js"),debounce=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/debounce.js"),interval=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/interval.js"),firstValueFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");class EntityBusinessService extends src.jh{get dataSettings(){return this.get((state=>state.dataSettings))}set dataSettings(value){const state=omitBy_omitBy({dataSettings:value,selectionVariant:value.selectionVariant,presentationVariant:value.presentationVariant},isNil_isNil);this.patchState(state)}get selectionVariant(){return this.get((state=>state.selectionVariant))}set selectionVariant(value){this.patchState({selectionVariant:value})}get presentationVariant(){return this.get((state=>state.presentationVariant))}set presentationVariant(value){this.patchState({presentationVariant:value})}get slicers(){return this.selectionVariant?.selectOptions}set slicers(value){this.selectionVariant={...this.selectionVariant??{},selectOptions:value}}get entityService(){return this.entityService$.value}constructor(dsCoreService){var _this;super({}),_this=this,this.dsCoreService=dsCoreService,this.dataSettings$=this.select((state=>state.dataSettings)),this._dataSource$=this.dataSettings$.pipe((0,map.T)((dataSettings=>dataSettings?.dataSource)),(0,distinctUntilChanged.F)()),this.entitySet$=this.dataSettings$.pipe((0,map.T)((dataSettings=>dataSettings?.entitySet)),(0,distinctUntilChanged.F)()),this.presentationVariant$=this.select((state=>state.presentationVariant)),this._initialise$=new BehaviorSubject.t(null),this.initialise$=this._initialise$.asObservable().pipe((0,filter.p)((initialised=>initialised))),this.loading$=new BehaviorSubject.t(null),this.result$=new BehaviorSubject.t(null),this.dataSource$=this._dataSource$.pipe((0,filter.p)(Boolean),(0,switchMap.n)((name=>this.dsCoreService.getDataSource(name))),(0,tap.M)((dataSource=>{this.patchState({dataSourceOptions:dataSource.options})})),(0,shareReplay.t)(1)),this.entityService$=new BehaviorSubject.t(null),this.internalError$=new ReplaySubject.m,this.refresh$=new ReplaySubject.m,this.__id__=uuid(),this.refresh$.pipe((0,delayWhen.o)((()=>this.initialise$)),(0,debounce.s)((()=>(0,interval.Y)(100))),(0,tap.M)((()=>this.loading$.next(!0))),(0,switchMap.n)((force=>{try{return this.selectQuery({force}).pipe((0,tap.M)((result=>{result.error&&this.internalError$.next(result.error)})),(0,catchError.W)((err=>(console.error(err),this.internalError$.next(err.message),(0,observable_of.of)({error:err.message})))))}catch(err){return console.error(err),this.internalError$.next(err.message),(0,observable_of.of)({error:err.message})}})),(0,tap.M)((()=>{this.loading$.next(!1)})),(0,takeUntil.Q)(this.destroySubject$)).subscribe(this.result$),this.entitySet$.pipe((0,filter.p)((entity=>!!entity)),(0,switchMap.n)((entity=>this.dataSource$.pipe((0,filter.p)((value=>!!value)),(0,map.T)((dataSource=>dataSource.createEntityService(entity)))))),(0,takeUntil.Q)(this.destroySubject$)).subscribe(function(){var _ref=(0,asyncToGenerator.A)((function*(entityService){_this.entityService?.onDestroy(),_this.entityService$.next(entityService),_this._initialise$.next(!1);try{_this.entityType=yield(0,firstValueFrom._)(entityService.selectEntityType()),_this._initialise$.next(!0)}catch(err){_this._initialise$.next(!1)}}));return function(_x){return _ref.apply(this,arguments)}}())}getEntityType(){var _this2=this;return(0,asyncToGenerator.A)((function*(){return yield(0,firstValueFrom._)(_this2.selectEntityType())}))()}getProperty(name){var _this3=this;return(0,asyncToGenerator.A)((function*(){return getEntityProperty(yield _this3.getEntityType(),name)}))()}selectEntityType(){return this.entityService$.pipe((0,filter.p)((value=>!!value)),(0,switchMap.n)((entityService=>entityService.selectEntityType())))}query(options){return this.selectQuery(options)}selectQuery(options){if(!this.entityService)throw new Error("Should provide attribute 'dataSettings' to create entity service");options=options??{};const presentationVariant=this.presentationVariant;return presentationVariant?.requestAtLeast&&(options.selects=options.selects||[],options.selects.push(...presentationVariant.requestAtLeast)),presentationVariant?.sortOrder&&(options.orderbys=options.orderbys||[],options.orderbys.push(...presentationVariant.sortOrder.filter(nonNullable))),isNil_isNil(presentationVariant?.maxItems)||(options.paging=options.paging||{},options.paging.top=presentationVariant.maxItems),isNil_isNil(presentationVariant?.skip)||(options.paging=options.paging||{},options.paging.skip=presentationVariant.skip),options=this.calculateFilters(options),this.entityService.selectQuery(options)}refresh(force){this.refresh$.next(force)}selectResult(){return this.result$.pipe((0,filter.p)(nonNullable))}calculateFilters(queryOptions){return queryOptions}getAnnotation(term,qualifier){return this.entityService.getAnnotation(term,qualifier)}getCalculatedMember(measure,type,calendar){return this.entityService.getCalculatedMember(measure,type,calendar)}getIndicator(idOrCode){return this.entityService.getIndicator(idOrCode)}}class SmartBusinessService extends EntityBusinessService{constructor(dsCoreService,smartFilterBar){super(dsCoreService),this.smartFilterBar=smartFilterBar,this.serviceInit$=this.initialise$.pipe((0,switchMap.n)((()=>this.onInit().pipe((0,catchError.W)(((err,caught)=>(console.error(err),empty.w)))))),(0,shareReplay.t)(1)),this.smartFilterBar?.onGo().subscribe((()=>{this.refresh()}))}onInit(){return this.dataSettings$.pipe((0,filter.p)(nonNullable),(0,distinctUntilChanged.F)(isEqual))}onAfterServiceInit(){return this.serviceInit$}selectQuery(options){let _filters=options?.filters??[];return this.smartFilterBar?.slicers?.forEach((ftr=>{_filters=putFilter(_filters,ftr,FilterMergeMode.ignore)})),super.selectQuery({...options??{},filters:_filters})}calculateFilters(queryOptions){const entityType=this.entityType;let _filters=queryOptions?.filters||[];const selectionVariant=this.selectionVariant;if(selectionVariant?.selectOptions){const filterString=[];selectionVariant.selectOptions.forEach((v=>{if(isString_isString(v))filterString.push(v);else if(isTimeRangesSlicer(v)){const{today}=this.dsCoreService.getToday(),ranges=function workOutTimeRangeSlicers(currentDate,timeSlicer,entityType){const property=getEntityCalendarHierarchy(entityType,timeSlicer.dimension);return timeSlicer.ranges.map((range=>{const calendarSemantic=mapTimeGranularitySemantic(range.granularity),calendarLevel=property?.levels?.find((level=>level.semantics?.semantic===calendarSemantic)),results=calcRange(currentDate||new Date,{...range,formatter:range.formatter||calendarLevel?.semantics?.formatter});return results[0]===results[1]?{dimension:timeSlicer.dimension,members:[{key:results[0],value:results[0]}]}:{dimension:timeSlicer.dimension,members:results.map((key=>({key,value:key}))),operator:types_FilterOperator.BT}}))}(today,v,entityType);_filters=putFilter(_filters,function toAdvancedFilter(slicers,filteringLogic=FilteringLogic.Or){return slicers.length>1?{filteringLogic,children:slicers}:slicers[0]}(ranges,FilteringLogic.And))}else isSlicer(v)&&isEmpty_isEmpty(v.members),_filters.push(v)})),isEmpty_isEmpty(filterString)||(queryOptions.filterString=queryOptions.filterString?`${queryOptions.filterString} ${filterString.join(" ")}`:filterString.join(" "))}return this.get((state=>state.dataSourceOptions?.settings?.ignoreUnknownProperty))&&(_filters=_filters.filter((f=>!f.dimension||(isAdvancedSlicer(f)?!!getEntityProperty(entityType,f.context[0]):f.dimension.parameter?!!entityType.parameters[f.dimension.parameter]:!!getEntityProperty(entityType,f.dimension))))),queryOptions.filters=_filters,queryOptions}}class ChartBusinessService extends SmartBusinessService{constructor(){super(...arguments),this.chartAnnotation$=this.dataSettings$.pipe((0,map.T)((dataSettings=>dataSettings?.chartAnnotation)),(0,distinctUntilChanged.F)())}get chartAnnotation(){return this.get((state=>state.dataSettings?.chartAnnotation))}onInit(){return this.dataSettings$.pipe((0,filter.p)((dataSettings=>!!dataSettings?.chartAnnotation?.measures?.length)),(0,distinctUntilChanged.F)(((a,b)=>isEqual({...a,chartAnnotation:pick_pick(a.chartAnnotation,"dimensions","measures")},{...b,chartAnnotation:pick_pick(b.chartAnnotation,"dimensions","measures")}))))}selectQuery(options){return(options=options??{}).rows=this.chartAnnotation.dimensions,options.columns=this.chartAnnotation.measures,super.selectQuery(options)}}var combineLatestWith=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/combineLatestWith.js");class AnalyticsBusinessService extends SmartBusinessService{constructor(){super(...arguments),this.analyticsAnnotation$=this.dataSettings$.pipe((0,map.T)((dataSettings=>dataSettings?.analytics)),(0,distinctUntilChanged.F)()),this.analytics$=this.analyticsAnnotation$.pipe((0,filter.p)(nonNullable),(0,combineLatestWith.v)(this.selectEntityType()),(0,map.T)((([analyticsAnnotation,entityType])=>({rows:analyticsAnnotation.rows?.filter(isBaseProperty).map((item=>({...item,property:types_isMeasure(item)?getEntityProperty(entityType,item):getEntityHierarchy(entityType,item)}))),columns:analyticsAnnotation.columns?.filter(isBaseProperty).map((item=>({...item,property:types_isMeasure(item)?getEntityProperty(entityType,item):getEntityHierarchy(entityType,item)})))}))))}get analyticsAnnotation(){return this.get((state=>state.dataSettings?.analytics))}onInit(){return super.onInit().pipe((0,map.T)((dataSettings=>dataSettings.analytics)),(0,filter.p)((analytics=>this.isMeetRequired(analytics))))}selectQuery(options){const analyticsAnnotation={...this.analyticsAnnotation,rows:this.analyticsAnnotation?.rows?.filter(isBaseProperty),columns:this.analyticsAnnotation?.columns?.filter(isBaseProperty)};if(!this.isMeetRequired(analyticsAnnotation))throw new Error("Analytics rows or columns is required");return(options=options??{}).rows=analyticsAnnotation.rows,options.columns=analyticsAnnotation.columns,super.selectQuery(options)}isMeetRequired(analytics){return!isEmpty_isEmpty(analytics?.rows?.filter(isBaseProperty))||!isEmpty_isEmpty(analytics?.columns?.filter(isBaseProperty))}}var TypeAheadType,MemberSource,ChartTypeEnum,ChartDataZoomType,withLatestFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");class SmartFilterBarService extends src.jh{get slicers(){return this._model$.value}constructor(_parent){super({}),this._parent=_parent,this._filters$=new BehaviorSubject.t([]),this.slicers$=this._filters$.asObservable(),this._model$=new BehaviorSubject.t(null),this._go$=new Subject.B,this._goWithDistinct$=new Subject.B,this._parent?.onGo().pipe((0,takeUntil.Q)(this.destroy$)).subscribe(this._go$),this._go$.pipe((0,withLatestFrom.E)(this._filters$,this._parent?.slicers$??(0,observable_of.of)(null)),(0,map.T)((([,slicers,pSlicers])=>(pSlicers?.forEach((item=>slicers=putFilter(slicers,item))),slicers))),(0,takeUntil.Q)(this.destroy$)).subscribe(this._model$),this._goWithDistinct$.pipe((0,withLatestFrom.E)(this._filters$,this._parent?.slicers$??(0,observable_of.of)(null)),(0,map.T)((([,slicers,pSlicers])=>(pSlicers?.forEach((item=>slicers=putFilter(slicers,item))),slicers))),(0,distinctUntilChanged.F)(isEqual),(0,takeUntil.Q)(this.destroy$)).subscribe(this._model$)}go(){this._go$.next()}distinctGo(){this._goWithDistinct$.next()}onGo(){return this._go$}change(ftrs){this._filters$.next(ftrs)}onChange(){return this._model$.pipe((0,filter.p)(nonNullable))}getFilters(){return this._model$.getValue()}put(...value){const slicers=this._model$.value??[];this.change(value.reduce(((slicers,item)=>putFilter(slicers,item)),slicers))}remove(value){this.change(function removeFilter(filters,value){return isFilter(value)?filters.filter(((item,i)=>item.dimension.dimension!==value.dimension.dimension)):filters.filter((item=>item.dimension.dimension!==value))}(this._model$.getValue()??[],value))}}!function(TypeAheadType){TypeAheadType.Local="Local",TypeAheadType.Remote="Remote"}(TypeAheadType||(TypeAheadType={})),function(MemberSource){MemberSource.CUBE="CUBE",MemberSource.DIMENSION="DIMENSION"}(MemberSource||(MemberSource={}));class SmartFilterService extends SmartBusinessService{set options(value){this.patchState({options:value})}get options(){return this.get((state=>state.options))}get dimension(){return this.options?.dimension}constructor(dsCoreService,_smartFilterBar){super(dsCoreService),this._smartFilterBar=_smartFilterBar,this.dimension$=this.select((state=>state.options?.dimension)),this.showAllMember$=this.select((state=>state.options?.showAllMember)),this.membersWithSchema$=(0,combineLatest.z)([this.selectResult().pipe((0,filter.p)((({data})=>!isNil_isNil(data)))),this.showAllMember$]).pipe((0,withLatestFrom.E)(this.selectEntityType()),(0,map.T)((([[{data,schema},showAllMember],entityType])=>{const hierarchy=getEntityHierarchy(entityType,this.dimension);let members=data;return!showAllMember&&hierarchy?.allMember&&(members=data.filter((item=>item.memberKey!==hierarchy.allMember))),{members,schema}}))),this.selectOptions$=this.membersWithSchema$.pipe((0,map.T)((({members})=>members.map((item=>({key:item.memberKey,value:item.memberKey,caption:item.memberCaption})))))),this.membersTree$=this.membersWithSchema$.pipe((0,map.T)((({members,schema})=>schema?.recursiveHierarchy?hierarchize(members,schema?.recursiveHierarchy):null))),this.variables$=this._smartFilterBar?.onChange().pipe((0,map.T)((slicers=>slicers.filter((slicer=>!!slicer.dimension?.parameter)))),(0,distinctUntilChanged.F)(isEqual))??(0,observable_of.of)([])}onInit(){return super.onInit().pipe((0,switchMap.n)((()=>this.dimension$.pipe((0,filter.p)((dimension=>!!dimension)),(0,map.T)((dimension=>({dimension:dimension.dimension,hierarchy:dimension.hierarchy,level:dimension.level}))),(0,distinctUntilChanged.F)(isEqual)))))}selectQuery(options){const memberSource=this.options?.memberSource;if(memberSource!==MemberSource.CUBE&&!this.dimension.level)return this.entityService.selectMembers(this.dimension).pipe((0,map.T)((data=>({data,schema:{columns:[{name:"memberKey",label:"Member Key",type:"string"},{name:"memberCaption",label:"Member Caption",type:"string"},{name:"parentKey",label:"Parent Key",type:"string"}],recursiveHierarchy:DimensionMemberRecursiveHierarchy}}))));const hProperty=getEntityHierarchy(this.entityType,this.dimension),dimension={...this.dimension,dimension:this.dimension.dimension,hierarchy:hProperty?.name,level:this.dimension.level??hProperty?.levels?.[hProperty.levels.length-1]?.name,displayHierarchy:!this.dimension.level},measure=getEntityDefaultMeasure(this.entityType);(options=options??{}).rows=[dimension],options.columns=[{dimension:types_C_MEASURES,measure:measure.name}],options.filters=[];const propertyName=getPropertyHierarchy(dimension);return this.variables$.pipe((0,switchMap.n)((filters=>super.selectQuery({...options,filters}))),(0,map.T)((result=>{const valueProperty=dimension.hierarchy||dimension.dimension,captionProperty=dimension.memberCaption||hProperty?.memberCaption,data=result.data?.map((item=>({dimension:dimension.dimension,hierarchy:dimension.hierarchy||dimension.dimension,memberKey:item[valueProperty],memberCaption:item[captionProperty],parentKey:item[`${propertyName}.[PARENT_UNIQUE_NAME]`]})));return{...result,data,schema:{columns:[{name:"memberKey",label:"Member Key",type:"string"},{name:"memberCaption",label:"Member Caption",type:"string"},{name:"parentKey",label:"Parent Key",type:"string"}],recursiveHierarchy:DimensionMemberRecursiveHierarchy}}})))}}!function(ChartTypeEnum){ChartTypeEnum.Column="Column",ChartTypeEnum.ColumnStacked="ColumnStacked",ChartTypeEnum.ColumnDual="ColumnDual",ChartTypeEnum.ColumnStackedDual="ColumnStackedDual",ChartTypeEnum.ColumnStacked100="ColumnStacked100",ChartTypeEnum.ColumnStackedDual100="ColumnStackedDual100",ChartTypeEnum.ColumnGrouped="ColumnGrouped",ChartTypeEnum.ColumnPolar="ColumnPolar",ChartTypeEnum.Bar="Bar",ChartTypeEnum.BarStacked="BarStacked",ChartTypeEnum.BarDual="BarDual",ChartTypeEnum.BarStackedDual="BarStackedDual",ChartTypeEnum.BarStacked100="BarStacked100",ChartTypeEnum.BarStackedDual100="BarStackedDual100",ChartTypeEnum.BarGrouped="BarGrouped",ChartTypeEnum.BarPolar="BarPolar",ChartTypeEnum.Histogram="Histogram",ChartTypeEnum.Area="Area",ChartTypeEnum.AreaStacked="AreaStacked",ChartTypeEnum.AreaStacked100="AreaStacked100",ChartTypeEnum.HorizontalArea="HorizontalArea",ChartTypeEnum.HorizontalAreaStacked="HorizontalAreaStacked",ChartTypeEnum.HorizontalAreaStacked100="HorizontalAreaStacked100",ChartTypeEnum.Line="Line",ChartTypeEnum.Lines="Lines",ChartTypeEnum.StepLine="StepLine",ChartTypeEnum.LineDual="LineDual",ChartTypeEnum.Combination="Combination",ChartTypeEnum.CombinationStacked="CombinationStacked",ChartTypeEnum.CombinationDual="CombinationDual",ChartTypeEnum.CombinationStackedDual="CombinationStackedDual",ChartTypeEnum.HorizontalCombinationStacked="HorizontalCombinationStacked",ChartTypeEnum.Pie="Pie",ChartTypeEnum.Doughnut="Doughnut",ChartTypeEnum.Nightingale="Nightingale",ChartTypeEnum.Scatter="Scatter",ChartTypeEnum.Bubble="Bubble",ChartTypeEnum.Radar="Radar",ChartTypeEnum.Boxplot="Boxplot",ChartTypeEnum.Heatmap="Heatmap",ChartTypeEnum.Treemap="Treemap",ChartTypeEnum.Waterfall="Waterfall",ChartTypeEnum.Bullet="Bullet",ChartTypeEnum.VerticalBullet="VerticalBullet",ChartTypeEnum.HorizontalWaterfall="HorizontalWaterfall",ChartTypeEnum.HorizontalCombinationDual="HorizontalCombinationDual",ChartTypeEnum.HorizontalCombinationStackedDual="HorizontalCombinationStackedDual",ChartTypeEnum.Bar3D="Bar3D",ChartTypeEnum.Line3D="Line3D",ChartTypeEnum.Scatter3D="Scatter3D",ChartTypeEnum.Custom="Custom",ChartTypeEnum.GeoMap="GeoMap",ChartTypeEnum.Timeline="Timeline",ChartTypeEnum.Sankey="Sankey",ChartTypeEnum.Sunburst="Sunburst",ChartTypeEnum.RadialBar="RadialBar",ChartTypeEnum.RadialBarStacked="RadialBarStacked",ChartTypeEnum.RadialPie="RadialPie",ChartTypeEnum.RadialPieStacked="RadialPieStacked",ChartTypeEnum.RadialScatter="RadialScatter",ChartTypeEnum.Funnel="Funnel",ChartTypeEnum.PolarLine="PolarLine",ChartTypeEnum.Rose="Rose",ChartTypeEnum.Tree="Tree",ChartTypeEnum.ThemeRiver="ThemeRiver"}(ChartTypeEnum||(ChartTypeEnum={})),function(ChartDataZoomType){ChartDataZoomType.inside="inside",ChartDataZoomType.slider="slider",ChartDataZoomType.inside_slider="inside&slider"}(ChartDataZoomType||(ChartDataZoomType={}));ChartTypeEnum.Bar,ChartTypeEnum.Bar,chart_ChartOrient.horizontal,BarVariant.None,ChartTypeEnum.Column,ChartTypeEnum.Bar,chart_ChartOrient.vertical,BarVariant.None,ChartTypeEnum.ColumnStacked,ChartTypeEnum.Bar,chart_ChartOrient.vertical,BarVariant.Stacked,ChartDimensionRoleType.Stacked,ChartTypeEnum.BarStacked,ChartTypeEnum.Bar,chart_ChartOrient.horizontal,BarVariant.Stacked,ChartDimensionRoleType.Stacked,ChartTypeEnum.BarPolar,ChartTypeEnum.Bar,chart_ChartOrient.horizontal,BarVariant.Polar,ChartTypeEnum.BarPolar,ChartTypeEnum.Bar,chart_ChartOrient.horizontal,BarVariant.Polar,ChartTypeEnum.ColumnPolar,ChartTypeEnum.Bar,chart_ChartOrient.vertical,BarVariant.Polar,ChartTypeEnum.Histogram,ChartTypeEnum.Bar,chart_ChartOrient.vertical,BarVariant.None,ChartTypeEnum.Combination,ChartTypeEnum.Bar,chart_ChartOrient.vertical,BarVariant.None,ChartMeasureRoleType.Axis2,ChartTypeEnum.Bar,ChartTypeEnum.Bar,chart_ChartOrient.vertical,BarVariant.None,ChartDimensionRoleType.Trellis,ChartTypeEnum.Pie,ChartTypeEnum.Pie,PieVariant.None,ChartTypeEnum.Doughnut,ChartTypeEnum.Pie,PieVariant.Doughnut,ChartTypeEnum.Doughnut,ChartTypeEnum.Pie,PieVariant.Doughnut,ChartTypeEnum.Nightingale,ChartTypeEnum.Pie,PieVariant.Nightingale,ChartTypeEnum.Nightingale,ChartTypeEnum.Pie,PieVariant.Nightingale,ChartTypeEnum.Waterfall,ChartTypeEnum.Waterfall,ChartTypeEnum.Line,ChartTypeEnum.Line,chart_ChartOrient.vertical,ChartTypeEnum.Line,ChartTypeEnum.Line,chart_ChartOrient.horizontal,ChartTypeEnum.Area,ChartTypeEnum.Line,chart_ChartOrient.vertical,ChartTypeEnum.AreaStacked,ChartTypeEnum.Line,chart_ChartOrient.vertical,ChartTypeEnum.ThemeRiver,ChartTypeEnum.ThemeRiver,ChartTypeEnum.Scatter,ChartTypeEnum.Scatter,ChartTypeEnum.Bubble,ChartTypeEnum.Scatter,ChartMeasureRoleType.Size,ChartTypeEnum.Heatmap,ChartTypeEnum.Heatmap,ChartTypeEnum.Boxplot,ChartTypeEnum.Boxplot,ChartTypeEnum.Tree,ChartTypeEnum.Tree,ChartTypeEnum.Treemap,ChartTypeEnum.Treemap,ChartTypeEnum.Sunburst,ChartTypeEnum.Sunburst,ChartTypeEnum.Sankey,ChartTypeEnum.Sankey,ChartTypeEnum.Funnel,ChartTypeEnum.Funnel,ChartTypeEnum.Radar,ChartTypeEnum.Radar,ChartTypeEnum.GeoMap,ChartTypeEnum.GeoMap,ChartTypeEnum.Bar3D,ChartTypeEnum.Bar3D,ChartTypeEnum.Line3D,ChartTypeEnum.Line3D,ChartTypeEnum.Scatter3D,ChartTypeEnum.Scatter3D,ChartTypeEnum.Custom,ChartTypeEnum.Custom;class SmartChartEngine extends src.jh{constructor(){super(...arguments),this.chartAnnotation$=this.select((state=>state.chartAnnotation)),this.entityType$=this.select((state=>state.entityType)),this.data$=this.select((state=>state.data)),this.settings$=this.select((state=>state.settings)),this.options$=this.select((state=>state.options))}get chartAnnotation(){return this.get((state=>state.chartAnnotation))}set chartAnnotation(value){this.patchState({chartAnnotation:value})}get entityType(){return this.get((state=>state.entityType))}set entityType(value){this.patchState({entityType:value})}get data(){return this.get((state=>state.data))}set data(value){this.patchState({data:value})}get setttings(){return this.get((state=>state.settings))}set settings(value){this.patchState({settings:value})}get options(){return this.get((state=>state.options))}set options(value){this.patchState({options:value})}selectChartOptions(items){throw new Error("Method not implemented.")}changeData(data){throw new Error("Method not implemented.")}processData(data){throw new Error("Method not implemented.")}onChartOptions(){throw new Error("Method not implemented.")}onDestroy(){super.onDestroy()}}var lib=__webpack_require__("./node_modules/zod/lib/index.mjs");lib.z.object({dataSource:lib.z.string().describe("The name of the data source"),entitySet:lib.z.string().describe("The name of the cube")});const baseDimensionSchema={dimension:lib.z.string().describe("The name of the dimension using pattern `[Dimension Name]`"),hierarchy:lib.z.string().optional().describe("The name of the hierarchy of the dimension using pattern `[Hierarchy Name]`"),level:lib.z.string().optional().describe("The name of the level in the hierarchy using pattern `[Hierarchy Name].[Level Name]`")},BaseMeasureSchema=(lib.z.object(baseDimensionSchema),{dimension:lib.z.enum([types_C_MEASURES]),measure:lib.z.string().describe("The name of the measure"),chartOptions:lib.z.any().optional().describe("The chart options of ECharts library")}),MemberSchema=(lib.z.object({...BaseMeasureSchema}),lib.z.object({key:lib.z.string().describe("the UniqueName of dimension member, for example: `[MemberKey]`"),caption:lib.z.string().optional().describe("the caption of dimension member")})),FormulaSchema=(lib.z.object({...baseDimensionSchema,members:lib.z.array(MemberSchema).optional().describe("Members in the dimension")}),lib.z.string().describe("MDX expression for the calculated measure in cube"));lib.z.object({__id__:lib.z.string().optional().describe("Key of the calculation measure"),name:lib.z.string().optional().describe("Name of the calculation measure, should be unique"),caption:lib.z.string().optional().describe("Caption (short description)"),description:lib.z.string().optional().describe("Long description"),formula:FormulaSchema,formatting:lib.z.object({unit:lib.z.string().optional().describe("Unit of the measure; if this is a ratio measurement, value is `%`"),decimal:lib.z.number().optional().describe("The decimal of value when formatting the measure")}).optional().describe("The formatting config of this measure")}),lib.z.object({by:lib.z.string().describe("Field to order by"),order:lib.z.enum([OrderDirection.ASC,OrderDirection.DESC]).describe("Order direction")}),lib.z.object({dimension:lib.z.object({dimension:lib.z.string().describe("The name of the dimension"),hierarchy:lib.z.string().optional().describe("The name of the hierarchy in the dimension"),parameter:lib.z.string().optional().describe("The name of variable reference to")}).describe("dimension of the variable"),members:lib.z.array(lib.z.object({key:lib.z.string().describe("the UniqueName of dimension member, for example: `[MemberKey]`"),caption:lib.z.string().optional().describe("the caption of dimension member")})).describe("Members in the variable")});lib.z.object({...baseDimensionSchema,role:lib.z.enum([ChartDimensionRoleType.Time,ChartDimensionRoleType.Stacked,ChartDimensionRoleType.Group]).nullable().optional().describe("Role of category axis")}),lib.z.object({...BaseMeasureSchema,role:lib.z.enum([ChartMeasureRoleType.Axis1,ChartMeasureRoleType.Axis2]).nullable().optional().describe("Role of value axis")}),lib.z.object({dimension:lib.z.object({dimension:lib.z.string().describe("The name of the dimension"),hierarchy:lib.z.string().optional().describe("The name of the hierarchy in the dimension"),level:lib.z.string().optional().describe("The name of the level in the hierarchy")}).describe("dimension of the slicer"),exclude:lib.z.boolean().optional().describe("Exclude members"),members:lib.z.array(MemberSchema).describe("Members in the slicer")}),lib.z.object({dimension:lib.z.object({dimension:lib.z.string().describe("The name of the dimension"),hierarchy:lib.z.string().optional().describe("The name of the hierarchy in the dimension")}).describe("the time dimension"),ranges:lib.z.array(lib.z.object({type:lib.z.enum([TimeRangeType.Standard,TimeRangeType.Offset]).describe("The type of time range"),granularity:lib.z.enum([TimeGranularity.Year,TimeGranularity.Quarter,TimeGranularity.Month,TimeGranularity.Week,TimeGranularity.Day]).describe("The granularity of the time range"),lookBack:lib.z.number().optional().describe("The look back period in granularity"),lookAhead:lib.z.number().optional().describe("The look ahead period in granularity")}))})},"./packages/store/src/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{jh:()=>ComponentStore});var ReplaySubject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/ReplaySubject.js"),isObservable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/util/isObservable.js"),of=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/of.js"),scheduled=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduled/scheduled.js"),queue=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/queue.js"),throwError=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),combineLatest=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),Subject=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subject.js"),concatMap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/concatMap.js"),withLatestFrom=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js"),takeUntil=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),take=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/take.js"),map=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/map.js"),distinctUntilChanged=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js"),shareReplay=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js"),Observable=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Observable.js"),Subscription=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/Subscription.js"),asap=__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/asap.js");function debounceSync(){return source=>new Observable.c((observer=>{let actionSubscription,actionValue;const rootSubscription=new Subscription.yU;return rootSubscription.add(source.subscribe({complete:()=>{actionSubscription&&observer.next(actionValue),observer.complete()},error:error=>{observer.error(error)},next:value=>{actionValue=value,actionSubscription||(actionSubscription=asap.$.schedule((()=>{observer.next(actionValue),actionSubscription=void 0})),rootSubscription.add(actionSubscription))}})),rootSubscription}))}var immer=__webpack_require__("./node_modules/immer/dist/immer.mjs");function isEmpty(obj){return[Object,Array].includes((obj||{}).constructor)&&!Object.entries(obj||{}).length}function pick(object,keys){return keys.reduce(((obj,key)=>(object&&Object.prototype.hasOwnProperty.call(object,key)&&(obj[key]=object[key]),obj)),{})}class ComponentStore{constructor(defaultState){this.destroySubject$=new ReplaySubject.m(1),this.destroy$=this.destroySubject$.asObservable(),this.stateSubject$=new ReplaySubject.m(1),this.isInitialized=!1,this.notInitializedErrorMessage=`${this.constructor.name} has not been initialized yet. Please make sure it is initialized before updating/getting.`,this.state$=this.select((s=>s)),defaultState&&this.initState(defaultState)}onDestroy(){this.stateSubject$.complete(),this.destroySubject$.next()}updater(updaterFn){return observableOrValue=>{let initializationError;const subscription=((0,isObservable.A)(observableOrValue)?observableOrValue:(0,of.of)(observableOrValue)).pipe((0,concatMap.H)((value=>this.isInitialized?(0,scheduled.c)([value],queue.T).pipe((0,withLatestFrom.E)(this.stateSubject$)):(0,throwError.$)((()=>new Error(this.notInitializedErrorMessage))))),(0,takeUntil.Q)(this.destroy$)).subscribe({next:([value,currentState])=>{this.stateSubject$.next(function immerReducer(callback){return(state,next)=>(0,immer.jM)(state,(draft=>callback(draft,next)))}(updaterFn)(currentState,value))},error:error=>{initializationError=error,this.stateSubject$.error(error)}});if(initializationError)throw initializationError;return subscription}}initState(state){this.isInitialized=!0,this.stateSubject$.next(state)}setState(stateOrUpdaterFn){"function"!=typeof stateOrUpdaterFn?this.initState(stateOrUpdaterFn):this.updater(stateOrUpdaterFn)()}patchState(partialStateOrUpdaterFn){const patchedState="function"==typeof partialStateOrUpdaterFn?partialStateOrUpdaterFn(this.get()):partialStateOrUpdaterFn;this.updater(((state,partialState)=>({...state,...partialState})))(patchedState)}get(projector){if(!this.isInitialized)throw new Error(this.notInitializedErrorMessage);let value;return this.stateSubject$.pipe((0,take.s)(1)).subscribe((state=>{value=projector?projector(state):state})),value}select(...args){const{observables,projector,config}=function processSelectorArgs(args){const selectorArgs=Array.from(args);let projector,config={debounce:!1};const projectorOrConfig=selectorArgs.pop();"function"!=typeof projectorOrConfig?(config={...config,...projectorOrConfig},projector=selectorArgs.pop()):projector=projectorOrConfig;const observables=selectorArgs;return{observables,projector,config}}(args);let observable$;return observable$=0===observables.length?this.stateSubject$.pipe(config.debounce?debounceSync():source$=>source$,(0,map.T)(projector)):(0,combineLatest.z)(observables).pipe(config.debounce?debounceSync():source$=>source$,(0,map.T)((projectorArgs=>projector(...projectorArgs)))),observable$.pipe((0,distinctUntilChanged.F)(),(0,shareReplay.t)({refCount:!0,bufferSize:1}),(0,takeUntil.Q)(this.destroy$))}effect(generator){const origin$=new Subject.B;return generator(origin$).pipe((0,takeUntil.Q)(this.destroy$)).subscribe(),observableOrValue=>((0,isObservable.A)(observableOrValue)?observableOrValue:(0,of.of)(observableOrValue)).pipe((0,takeUntil.Q)(this.destroy$)).subscribe((value=>{origin$.next(value)}))}sync(source,options){source.select((state=>isEmpty(options?.watchProperty)?state:pick(state,options?.watchProperty))).pipe((0,take.s)(1)).subscribe((state=>{this.patchState(state)})),this.select((state=>isEmpty(options?.watchProperty)?state:pick(state,options?.watchProperty))).subscribe((state=>{source.setState(state)}))}}__webpack_require__("./node_modules/rxjs/dist/esm5/internal/scheduler/async.js"),__webpack_require__("./node_modules/rxjs/dist/esm5/internal/operators/filter.js");__webpack_require__("./node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js")}}]);